<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>hdpGLM • hdpGLM</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="hdpGLM">
<meta property="og:description" content="hdpGLM">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">hdpGLM</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/hdpGLM.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="https://www.cambridge.org/core/journals/political-analysis/article/modeling-contextdependent-latent-effect-heterogeneity/B7B0AF067DF97A1A8F0B50646EF64F24" class="external-link">Paper</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/DiogoFerrari/hdpGLM/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>hdpGLM</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/DiogoFerrari/hdpGLM/blob/HEAD/vignettes/hdpGLM.Rmd" class="external-link"><code>vignettes/hdpGLM.Rmd</code></a></small>
      <div class="hidden name"><code>hdpGLM.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The package hdpGLM makes it easy to estimate semi-parametric
regression models, and summarize and visualize the results. The package
is useful for many purposes:</p>
<ol style="list-style-type: decimal">
<li>Find clusters using semi-parametric Bayesian methods (Dirichlet
Process)</li>
<li>Find a set of generalized linear models (GLM) that apply to
different latent subpopulations</li>
<li>Estimate latent heterogeneity in the marginal effect of regression
coefficients</li>
<li>Investigate if Simpson’s Paradox occurs due to latent or omitted
features</li>
<li>Cluster the data points based on marginal effect heterogeneity</li>
<li>All the above, but with hierarchical data from many contexts (e.g.,
schools, hospitals, cities, states, countries, etc.)</li>
<li>Find the effect of context-level features (upper-level covariates)
on the latent heterogeneity of within-context features (lower-level
covariates)</li>
</ol>
</div>
<div class="section level2">
<h2 id="background">Background<a class="anchor" aria-label="anchor" href="#background"></a>
</h2>
<p>The <code>hdpGLM</code> works similarly to linear regression models.
It estimates coefficients of linear regressions, including generalized
linear models, such as logit coefficients. But it simultaneously
searches for latent clusters in the data and estimates the linear
coefficients for those clusters. The result of the estimation is <span class="math inline">\(K\)</span> vectors of linear coefficients, one
vector for each cluster. If there are no clusters in the data, it
returns the estimated coefficients similar to classical regression
models.</p>
<p>The clustering procedure is based on a hierarchical semi-parametric
Bayesian model proposed in <span class="citation">Ferrari (2020)</span>.
The model, called Hierarchical Dirichlet process Generalized Linear
Models (hdpGLM), can be used to deal with latent heterogeneity in
different situations, including those that emerge due to unobserved
variables. It deals with the latent heterogeneity in two ways: (1) it
finds latent clusters which can be better described by different
regression models and (2) estimate the coefficient of those models. The
hdpGLM can also be used with hierarchical data to estimate latent
heterogeneity in multiple contexts and check if the clusters are
context-dependent (see an example in section <a href="#Estimating-Context-dependent-Latent-Heterogeneity">Estimating
Context-dependent latent heterogeneity</a>).</p>
<p>The linear model is estimated by sampling from the posterior
distribution using a Gibbs sampler. Non-linear models (e.g., logit with
binary outcomes) use Hamiltonian Monte Carlo within Gibbs. The
algorithms are presented in <span class="citation">Ferrari
(2020)</span>.</p>
<p>Why should we estimate clusters of linear regressions instead of
fitting a single regression model?</p>
<p>First, it improves the predictive performance of the regression model
and keeps the interpretability of the regression coefficients.
<code>hdpGLM</code> is much more flexible than traditional regression
and produces monotonically lower root mean square error (see <span class="citation">Ferrari (2020)</span> for details).</p>
<p>Second, latent heterogeneity emerges when there are omitted variables
in the estimation of regression models. The <code>hdpGLM</code> can be
used to estimate marginal effects even when interactions were omitted.
It recovers the linear coefficients of each latent group.</p>
</div>
<div class="section level2">
<h2 id="usage">Usage<a class="anchor" aria-label="anchor" href="#usage"></a>
</h2>
<div class="section level3">
<h3 id="estimation">Estimation<a class="anchor" aria-label="anchor" href="#estimation"></a>
</h3>
<p>The function <code>hdpGLM</code> estimates a semi-parametric Bayesian
regression model. The syntax is similar to other R functions such as
<code><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm()</a></code>, <code><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm()</a></code>, and <code>lmer()</code>.</p>
<p>Here is a toy example. Suppose we are studying how income inequality
affects support policies that help alleviate poverty in a given country
A. Yet, suppose further that (1) the effect of inequality varies between
groups of people; for some people, inequality increases support for
welfare policies, but for others, it decreases welfare policy support;
(2) we don’t know which individual belongs to which group. The data set
<code>welfare</code> contains simulated data for this example.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## loading and looking at the data</span></span>
<span><span class="va">welfare</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv2</a></span><span class="op">(</span><span class="st">'welfare.csv'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">welfare</span><span class="op">)</span></span>
<span><span class="co">#&gt;       support inequality     income   ideology</span></span>
<span><span class="co">#&gt; 1 -18.5649610  0.3392724  0.1425111  1.9225985</span></span>
<span><span class="co">#&gt; 2  -9.3905812 -0.9906646 -0.5117102  0.2483346</span></span>
<span><span class="co">#&gt; 3   0.9276234 -2.2318510 -0.3856288 -1.3619216</span></span>
<span><span class="co">#&gt; 4 -12.3594498 -3.0079501 -0.9440585 -0.2088675</span></span>
<span><span class="co">#&gt; 5  -2.4834411  0.1000455  0.8322192  0.1321378</span></span>
<span><span class="co">#&gt; 6 -11.4187853 -0.9543883 -0.8810503  0.2916444</span></span></code></pre></div>
<p>Now, suppose that inequality increases support for welfare only among
women, but it decreases support among men. We didn’t collect data on
gender (male versus female). We could estimate the <code>hdpGLM</code>
and recover the coefficients even if gender wasn’t observed. The package
provides a function called <code>hdpGLM</code>, which estimates a
semi-parametric Bayesian generalized linear model using a Dirichlet
mixture. Let’s estimate the model. The example uses few iterations in
the MCMC, but in real applications, one should use a much larger
number.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/DiogoFerrari/hdpGLM" class="external-link">hdpGLM</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ## ===============================================================</span></span>
<span><span class="co">#&gt; ## Hierarchial Dirichlet Process Generalized Linear Model (hdpGLM)</span></span>
<span><span class="co">#&gt; ## ===============================================================</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Author: Diogo Ferrari</span></span>
<span><span class="co">#&gt; Usage : https://github.com/DiogoFerrari/hdpGLM</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'hdpGLM'</span></span>
<span><span class="co">#&gt; The following object is masked _by_ '.GlobalEnv':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     welfare</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## estimating the model</span></span>
<span><span class="va">mcmc</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>burn.in<span class="op">=</span><span class="fl">10</span>, <span class="co">## MCMC burn-in period</span></span>
<span>            n.iter <span class="op">=</span><span class="fl">500</span><span class="op">)</span> <span class="co">## number of MCMC iterations to keep</span></span>
<span><span class="va">mod</span> <span class="op">=</span> <span class="fu"><a href="../reference/hdpGLM.html">hdpGLM</a></span><span class="op">(</span><span class="va">support</span> <span class="op">~</span> <span class="va">inequality</span> <span class="op">+</span> <span class="va">income</span> <span class="op">+</span> <span class="va">ideology</span>, data<span class="op">=</span><span class="va">welfare</span>,</span>
<span>             mcmc<span class="op">=</span><span class="va">mcmc</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## printing the outcome</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; -------------------------------- </span></span>
<span><span class="co">#&gt; dpGLM model object</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Maximum number of clusters activated during the estimation: 17</span></span>
<span><span class="co">#&gt; Number of MCMC iterations: 500</span></span>
<span><span class="co">#&gt; burn-in: 10</span></span>
<span><span class="co">#&gt; -------------------------------- </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Summary statistics of clusters with data points</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; --------------------------------</span></span>
<span><span class="co">#&gt; Coefficients for cluster 1 (cluster label 1)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;               Post.Mean Post.Median  HPD.lower HPD.upper</span></span>
<span><span class="co">#&gt; 1 (Intercept) -3.873715   -3.871650 -3.9419177 -3.799313</span></span>
<span><span class="co">#&gt; 2  inequality  1.996367    1.997121  1.9295035  2.067975</span></span>
<span><span class="co">#&gt; 3      income  3.845303    3.843416  3.7742272  3.913058</span></span>
<span><span class="co">#&gt; 4    ideology -8.307966   -8.309522 -8.3707962 -8.234153</span></span>
<span><span class="co">#&gt; 5       sigma  1.001683    1.001865  0.9102844  1.087296</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; --------------------------------</span></span>
<span><span class="co">#&gt; Coefficients for cluster 2 (cluster label 11)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                Post.Mean Post.Median  HPD.lower HPD.upper</span></span>
<span><span class="co">#&gt; 1 (Intercept) -3.8150726  -3.8142184 -3.8874369 -3.743100</span></span>
<span><span class="co">#&gt; 2  inequality -1.5279347  -1.5315021 -1.5909281 -1.456357</span></span>
<span><span class="co">#&gt; 3      income  3.8779553   3.8772162  3.8068012  3.937593</span></span>
<span><span class="co">#&gt; 4    ideology -8.2578467  -8.2587874 -8.3219756 -8.178930</span></span>
<span><span class="co">#&gt; 5       sigma  0.9667212   0.9706523  0.8431746  1.054893</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; --------------------------------</span></span></code></pre></div>
<p>The summary function prints the result in a tidy format. The column
<code>k</code> in the summary shows the label of the estimated clusters.
The column <code>Mean</code> is the average of the posterior
distribution for each linear coefficient in each cluster.</p>
<p>The function <code>classify</code> can be used to classify the data
points into clusters based on the estimation.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">welfare_clustered</span> <span class="op">=</span> <span class="fu"><a href="../reference/classify.html">classify</a></span><span class="op">(</span><span class="va">welfare</span>, <span class="va">mod</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">welfare_clustered</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Cluster     support inequality     income   ideology</span></span>
<span><span class="co">#&gt; 1       1 -18.5649610  0.3392724  0.1425111  1.9225985</span></span>
<span><span class="co">#&gt; 2       1  -9.3905812 -0.9906646 -0.5117102  0.2483346</span></span>
<span><span class="co">#&gt; 3       1   0.9276234 -2.2318510 -0.3856288 -1.3619216</span></span>
<span><span class="co">#&gt; 4       1 -12.3594498 -3.0079501 -0.9440585 -0.2088675</span></span>
<span><span class="co">#&gt; 5      11  -2.4834411  0.1000455  0.8322192  0.1321378</span></span>
<span><span class="co">#&gt; 6       1 -11.4187853 -0.9543883 -0.8810503  0.2916444</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">welfare_clustered</span><span class="op">)</span></span>
<span><span class="co">#&gt;      Cluster     support  inequality     income   ideology</span></span>
<span><span class="co">#&gt; 1995      11  -1.5230053 1.055855140 -0.7295937 -0.7067871</span></span>
<span><span class="co">#&gt; 1996      11   0.4814892 0.582588091  2.0051082  0.3090389</span></span>
<span><span class="co">#&gt; 1997      11 -14.1929956 0.391164197 -0.9607449  0.7765482</span></span>
<span><span class="co">#&gt; 1998       1  -8.2396789 0.074437376  1.2020300  1.0874928</span></span>
<span><span class="co">#&gt; 1999      11 -23.1583753 0.434223018 -0.6176438  2.0387294</span></span>
<span><span class="co">#&gt; 2000      11  -7.2075582 0.008355317 -0.4538951  0.2268072</span></span></code></pre></div>
<p>There are a series of built-in functions, with various options, to
plot the results. In the example below, you see two of those options.
The <code>separate</code> parameter plot the posterior samples for each
cluster separately, and the option <code>ncols</code> controls how many
columns to use for the panels in the figure (to see more, run
<code><a href="../reference/plot.hdpGLM.html">help(plot.hdpGLM)</a></code> and <code><a href="../reference/plot.dpGLM.html">help(plot.dpGLM)</a></code>).</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mod</span>, separate<span class="op">=</span><span class="cn">T</span>, ncols<span class="op">=</span><span class="fl">4</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Generating plot...</span></span></code></pre></div>
<p><img src="hdpGLM_files/figure-html/unnamed-chunk-6-1.png" width="691.2"></p>
</div>
<div class="section level3">
<h3 id="estimating-context-dependent-latent-heterogeneity">Estimating Context-dependent Latent Heterogeneity<a class="anchor" aria-label="anchor" href="#estimating-context-dependent-latent-heterogeneity"></a>
</h3>
<p>To continue the previous toy example, suppose that we are analyzing
data from many countries, and we suspect that the latent heterogeneity
is different in each country. The effect of inequality on support for
welfare may be gender-specific only in some countries (contexts). Or
maybe the way it is gender-specific varies from country to country.
Suppose we didn’t have data on gender, but we collect information on
countries’ gender gap in welfare provision. Let’s look at this new data
set.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## loading and looking at the data</span></span>
<span><span class="va">welfare</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv2</a></span><span class="op">(</span><span class="st">'welfare2.csv'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">welfare</span><span class="op">)</span></span>
<span><span class="co">#&gt;       support inequality     income   ideology country gap</span></span>
<span><span class="co">#&gt; 1 -18.5649610  0.3392724  0.1425111  1.9225985       0 0.1</span></span>
<span><span class="co">#&gt; 2  -9.3905812 -0.9906646 -0.5117102  0.2483346       0 0.1</span></span>
<span><span class="co">#&gt; 3   0.9276234 -2.2318510 -0.3856288 -1.3619216       0 0.1</span></span>
<span><span class="co">#&gt; 4 -12.3594498 -3.0079501 -0.9440585 -0.2088675       0 0.1</span></span>
<span><span class="co">#&gt; 5  -2.4834411  0.1000455  0.8322192  0.1321378       0 0.1</span></span>
<span><span class="co">#&gt; 6 -11.4187853 -0.9543883 -0.8810503  0.2916444       0 0.1</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">welfare</span><span class="op">)</span></span>
<span><span class="co">#&gt;         support inequality     income    ideology country        gap</span></span>
<span><span class="co">#&gt; 3195  0.3190583 -0.7504798 -0.7839583  0.92300705       4 -0.8280808</span></span>
<span><span class="co">#&gt; 3196 -1.3837239  0.6620435 -1.5566268  0.05634618       4 -0.8280808</span></span>
<span><span class="co">#&gt; 3197 -1.3820016 -0.4298706 -1.0945688  0.71559078       4 -0.8280808</span></span>
<span><span class="co">#&gt; 3198  0.6878775  0.5450604  2.6175887 -1.94844469       4 -0.8280808</span></span>
<span><span class="co">#&gt; 3199 -7.9282930  1.7846004  1.6755823  1.29160208       4 -0.8280808</span></span>
<span><span class="co">#&gt; 3200 -1.7472485  0.5030992 -0.5395479  0.20109879       4 -0.8280808</span></span></code></pre></div>
<p>The variable <code>country</code> indicates the country (context) of
the observation, and the variable <code>gap</code> the gender gap in
welfare provision in the respective country. The estimation is similar
to the previous example, but now there is a second <code>formula</code>
for the context-level variables. Again, the example below uses few
iterations in the MCMC, but in practical applications, one needs to
increase that).</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## estimating the model</span></span>
<span><span class="va">mcmc</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>burn.in<span class="op">=</span><span class="fl">1</span>, <span class="co">## MCMC burn-in period</span></span>
<span>            n.iter <span class="op">=</span><span class="fl">50</span><span class="op">)</span> <span class="co">## number of MCMC iterations to keep</span></span>
<span><span class="va">mod</span> <span class="op">=</span> <span class="fu"><a href="../reference/hdpGLM.html">hdpGLM</a></span><span class="op">(</span><span class="va">support</span> <span class="op">~</span> <span class="va">inequality</span> <span class="op">+</span> <span class="va">income</span> <span class="op">+</span> <span class="va">ideology</span>, </span>
<span>             <span class="va">support</span> <span class="op">~</span> <span class="va">gap</span>,</span>
<span>         data<span class="op">=</span><span class="va">welfare</span>, mcmc<span class="op">=</span><span class="va">mcmc</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; -------------------------------- </span></span>
<span><span class="co">#&gt; hdpGLM Object </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Maximum number of clusters activated during the estimation: 1</span></span>
<span><span class="co">#&gt; Number of MCMC iterations: 50</span></span>
<span><span class="co">#&gt; Burn-in: 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of contexts : 5</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of clusters (summary across contexts): </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   Average  Std.Dev Median Min. Max.</span></span>
<span><span class="co">#&gt; 1     5.2 1.095445      5    4    7</span></span>
<span><span class="co">#&gt; -------------------------------- </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Summary statistics of clusters with data points in each context</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; --------------------------------</span></span>
<span><span class="co">#&gt; Coefficients and clusters for context 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                Post.Mean Post.Median  HPD.lower  HPD.upper Cluster</span></span>
<span><span class="co">#&gt; 1  (Intercept) -3.835050   -3.835730 -3.9205518 -3.7453447       1</span></span>
<span><span class="co">#&gt; 2   inequality -1.263659   -1.527083 -1.6225980  0.1847649       1</span></span>
<span><span class="co">#&gt; 3       income  3.919153    3.919837  3.8296208  4.0093341       1</span></span>
<span><span class="co">#&gt; 4     ideology -8.295974   -8.276974 -8.4701995 -8.2137369       1</span></span>
<span><span class="co">#&gt; 5  (Intercept) -3.310240   -3.410696 -4.0457301 -2.2803845       3</span></span>
<span><span class="co">#&gt; 6   inequality  1.097415    1.162369  0.4655637  1.7108706       3</span></span>
<span><span class="co">#&gt; 7       income  2.839111    2.879233  1.4662062  3.9446805       3</span></span>
<span><span class="co">#&gt; 8     ideology -7.405830   -7.667885 -8.0612432 -5.2415350       3</span></span>
<span><span class="co">#&gt; 9  (Intercept) -3.638716   -4.026695 -4.9438793  3.3031808       7</span></span>
<span><span class="co">#&gt; 10  inequality  1.625881    1.612256 -1.4192852  4.6971788       7</span></span>
<span><span class="co">#&gt; 11      income  3.976647    4.078838  1.1414005  5.6714598       7</span></span>
<span><span class="co">#&gt; 12    ideology -6.104990   -6.619078 -7.2483318 -0.6565273       7</span></span>
<span><span class="co">#&gt; 13 (Intercept) -3.679054   -3.877312 -3.9637139 -1.6769418      11</span></span>
<span><span class="co">#&gt; 14  inequality  2.288014    2.019501  1.9519357  4.9660539      11</span></span>
<span><span class="co">#&gt; 15      income  3.722558    3.838979  2.5876326  3.9370305      11</span></span>
<span><span class="co">#&gt; 16    ideology -8.063575   -8.347024 -8.5262398 -5.0018639      11</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; --------------------------------</span></span>
<span><span class="co">#&gt; Coefficients and clusters for context 4</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                  Post.Mean Post.Median   HPD.lower  HPD.upper Cluster</span></span>
<span><span class="co">#&gt; 1  (Intercept)  0.17116286  0.14909969 -0.53872727  0.9281810       1</span></span>
<span><span class="co">#&gt; 2   inequality -0.96820681 -1.02401360 -3.06288060  2.8577652       1</span></span>
<span><span class="co">#&gt; 3       income -2.25657944 -2.51780337 -2.63385523  2.0696568       1</span></span>
<span><span class="co">#&gt; 4     ideology -0.21020458 -0.01221269 -5.18419496  0.2438383       1</span></span>
<span><span class="co">#&gt; 5  (Intercept)  0.33574117  0.31735340 -0.04629298  1.1164151       2</span></span>
<span><span class="co">#&gt; 6   inequality -1.12170290 -1.15030002 -1.38996838 -0.5037393       2</span></span>
<span><span class="co">#&gt; 7       income -2.26796183 -2.28515205 -2.94096248 -0.8444700       2</span></span>
<span><span class="co">#&gt; 8     ideology  0.66256661  0.63552669  0.34351236  1.2383910       2</span></span>
<span><span class="co">#&gt; 9  (Intercept)  0.45154920  0.35351737 -0.20527119  1.0227800       3</span></span>
<span><span class="co">#&gt; 10  inequality -0.66671100 -0.74438404 -1.03657135 -0.2552719       3</span></span>
<span><span class="co">#&gt; 11      income -2.51776514 -2.63575850 -3.12271708 -1.6531951       3</span></span>
<span><span class="co">#&gt; 12    ideology -0.60425881 -0.37359014 -1.91428966  0.5226239       3</span></span>
<span><span class="co">#&gt; 13 (Intercept)  0.09359862 -0.01253591 -0.28914463  0.8969488       5</span></span>
<span><span class="co">#&gt; 14  inequality -1.16645677 -1.20789495 -1.55451358 -0.8899782       5</span></span>
<span><span class="co">#&gt; 15      income -2.51002136 -2.56098871 -3.13867038 -2.0084782       5</span></span>
<span><span class="co">#&gt; 16    ideology -0.51781190 -0.46681748 -0.90597592 -0.1757184       5</span></span>
<span><span class="co">#&gt; 17 (Intercept) -0.57678094  0.12874044 -5.92647462  2.1284888       6</span></span>
<span><span class="co">#&gt; 18  inequality -0.68034666 -0.73971795 -6.21925701  4.6559052       6</span></span>
<span><span class="co">#&gt; 19      income -3.22898449 -3.43891550 -6.10744570  0.3567308       6</span></span>
<span><span class="co">#&gt; 20    ideology -0.05041177  0.82109998 -6.55373345  4.8437599       6</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; --------------------------------</span></span>
<span><span class="co">#&gt; Coefficients and clusters for context 2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                 Post.Mean Post.Median   HPD.lower   HPD.upper Cluster</span></span>
<span><span class="co">#&gt; 1  (Intercept)  1.4869088   1.4159976  0.85987970  2.49804574       2</span></span>
<span><span class="co">#&gt; 2   inequality  0.8452028   0.8669372  0.23398854  1.15848823       2</span></span>
<span><span class="co">#&gt; 3       income  0.8038565   0.8440399  0.28361982  1.07624944       2</span></span>
<span><span class="co">#&gt; 4     ideology -1.9875338  -1.8621675 -2.96526617 -1.47115960       2</span></span>
<span><span class="co">#&gt; 5  (Intercept)  1.2160219   1.2345206  0.64440858  1.77343885       4</span></span>
<span><span class="co">#&gt; 6   inequality  0.7906638   0.8202812  0.33533153  1.17763923       4</span></span>
<span><span class="co">#&gt; 7       income  0.6876470   0.7016709  0.01889381  1.39544258       4</span></span>
<span><span class="co">#&gt; 8     ideology -1.3649430  -1.2916067 -2.04318722 -0.76657970       4</span></span>
<span><span class="co">#&gt; 9  (Intercept)  1.5801206   1.3078434  0.78470927  4.75755371       7</span></span>
<span><span class="co">#&gt; 10  inequality  0.9034592   1.4248372 -4.82713971  3.03605769       7</span></span>
<span><span class="co">#&gt; 11      income  1.1533809   1.2655310  0.23819496  1.80560401       7</span></span>
<span><span class="co">#&gt; 12    ideology -2.2922069  -2.6285115 -3.25039469  2.10063790       7</span></span>
<span><span class="co">#&gt; 13 (Intercept)  0.9683229   1.0373535 -1.25223180  5.25095643       9</span></span>
<span><span class="co">#&gt; 14  inequality -1.4893317  -1.4716189 -6.67477820  2.17460438       9</span></span>
<span><span class="co">#&gt; 15      income  1.8720454   2.1151393 -0.55921507  3.69710100       9</span></span>
<span><span class="co">#&gt; 16    ideology -1.0285446  -1.1119027 -4.31843400  1.23619011       9</span></span>
<span><span class="co">#&gt; 17 (Intercept) -0.3707455  -0.2906614 -1.46414051 -0.04936855      10</span></span>
<span><span class="co">#&gt; 18  inequality -1.1944827  -1.1891572 -1.42770552 -0.97890382      10</span></span>
<span><span class="co">#&gt; 19      income -0.5786515  -0.5424502 -0.79025823 -0.36505107      10</span></span>
<span><span class="co">#&gt; 20    ideology -2.2033634  -2.3061323 -2.54271976 -1.13954864      10</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; --------------------------------</span></span>
<span><span class="co">#&gt; Coefficients and clusters for context 3</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                  Post.Mean Post.Median  HPD.lower  HPD.upper Cluster</span></span>
<span><span class="co">#&gt; 1  (Intercept) -1.48466146  -1.4253556 -3.1885817 -0.7477250       2</span></span>
<span><span class="co">#&gt; 2   inequality  0.28009241   0.2741804 -0.7735654  1.0012038       2</span></span>
<span><span class="co">#&gt; 3       income -3.22841524  -3.3443263 -3.6497695 -2.3286925       2</span></span>
<span><span class="co">#&gt; 4     ideology  1.21339989   1.3553076 -0.3443431  1.9915185       2</span></span>
<span><span class="co">#&gt; 5  (Intercept)  0.01774836   0.2466775 -1.3181386  0.7420762       4</span></span>
<span><span class="co">#&gt; 6   inequality -0.13442747  -0.1731420 -0.4842205  0.2664828       4</span></span>
<span><span class="co">#&gt; 7       income -3.43529885  -3.6375321 -4.2275235 -0.3784703       4</span></span>
<span><span class="co">#&gt; 8     ideology  1.05379180   1.0265938  0.6296705  1.5043865       4</span></span>
<span><span class="co">#&gt; 9  (Intercept)  0.19217592   0.2524679 -0.6286662  0.7482620       7</span></span>
<span><span class="co">#&gt; 10  inequality  0.61734764   0.6549775  0.3463767  1.1351539       7</span></span>
<span><span class="co">#&gt; 11      income -2.57440522  -2.8430172 -3.5618107 -0.9035868       7</span></span>
<span><span class="co">#&gt; 12    ideology  2.19180085   2.2682227  1.8161366  2.8625215       7</span></span>
<span><span class="co">#&gt; 13 (Intercept) -0.17817561  -0.1895465 -0.5297409  0.2204278       8</span></span>
<span><span class="co">#&gt; 14  inequality -0.47623827  -0.6359246 -0.9141406  0.9170122       8</span></span>
<span><span class="co">#&gt; 15      income -3.96382973  -4.1233374 -4.4723486 -1.8216157       8</span></span>
<span><span class="co">#&gt; 16    ideology  0.43608490   0.4652627 -0.4641050  0.8498888       8</span></span>
<span><span class="co">#&gt; 17 (Intercept)  0.03410075  -0.1775383 -1.0605869  2.5202935       9</span></span>
<span><span class="co">#&gt; 18  inequality -0.69203370  -0.6379193 -3.3322362  0.5199053       9</span></span>
<span><span class="co">#&gt; 19      income -2.62790906  -2.9764876 -4.2610287  1.7286133       9</span></span>
<span><span class="co">#&gt; 20    ideology  1.77872362   1.9806269 -2.2610396  4.2387174       9</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; --------------------------------</span></span>
<span><span class="co">#&gt; Coefficients and clusters for context 5</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                  Post.Mean   Post.Median   HPD.lower   HPD.upper Cluster</span></span>
<span><span class="co">#&gt; 1  (Intercept)  0.05327797 -0.0302423891 -0.70408299  1.07089931       3</span></span>
<span><span class="co">#&gt; 2   inequality  1.44752487  1.5159274776  0.68586647  2.42497404       3</span></span>
<span><span class="co">#&gt; 3       income -1.02875055 -1.0612379693 -2.03930620  0.03293921       3</span></span>
<span><span class="co">#&gt; 4     ideology -1.61834430 -1.8216953724 -2.69801033 -0.17123332       3</span></span>
<span><span class="co">#&gt; 5  (Intercept) -1.67658556 -1.6054552948 -2.29276048 -1.05267269       4</span></span>
<span><span class="co">#&gt; 6   inequality -1.07769274 -1.0822862837 -1.80428125 -0.56528835       4</span></span>
<span><span class="co">#&gt; 7       income  0.02868995  0.0003332608 -0.37552929  0.58784512       4</span></span>
<span><span class="co">#&gt; 8     ideology -1.57191632 -1.5646018478 -2.19826906 -0.61250591       4</span></span>
<span><span class="co">#&gt; 9  (Intercept)  1.11676004  0.9471420984  0.30006839  3.59715343       5</span></span>
<span><span class="co">#&gt; 10  inequality -1.46905455 -1.4046334297 -3.51358142 -0.17972887       5</span></span>
<span><span class="co">#&gt; 11      income -0.80778403 -0.5207793636 -3.39197061  0.48808285       5</span></span>
<span><span class="co">#&gt; 12    ideology -1.88312459 -1.6788341227 -7.51034221  2.56983652       5</span></span>
<span><span class="co">#&gt; 13 (Intercept) -0.17695488 -0.1788097212 -0.82747964  0.37057320       6</span></span>
<span><span class="co">#&gt; 14  inequality  0.74982527  0.8037699469 -0.25196988  1.21600658       6</span></span>
<span><span class="co">#&gt; 15      income  0.23791787  0.0514154257 -0.48780781  2.96994452       6</span></span>
<span><span class="co">#&gt; 16    ideology -2.08284826 -2.3062287163 -2.88275610  1.38138343       6</span></span>
<span><span class="co">#&gt; 17 (Intercept)  0.18013533  0.1687989479 -0.06679425  0.51190162       7</span></span>
<span><span class="co">#&gt; 18  inequality -2.71426173 -2.7434513502 -3.02369945 -2.16089588       7</span></span>
<span><span class="co">#&gt; 19      income  0.09911700  0.0402475072 -0.25100134  1.33501621       7</span></span>
<span><span class="co">#&gt; 20    ideology -2.33078530 -2.4056657453 -2.74135102 -1.42135069       7</span></span>
<span><span class="co">#&gt; 21 (Intercept) -0.12372037 -0.1639090579 -0.82479947  0.58656701       8</span></span>
<span><span class="co">#&gt; 22  inequality  0.88393401  0.7235603719  0.28929004  2.82755575       8</span></span>
<span><span class="co">#&gt; 23      income -0.79743714 -0.6396553433 -2.94812296 -0.02039296       8</span></span>
<span><span class="co">#&gt; 24    ideology -1.56697973 -1.5350585222 -2.58752854  0.25084894       8</span></span>
<span><span class="co">#&gt; 25 (Intercept)  0.62559821  0.7224444872 -3.25588992  1.64335993       9</span></span>
<span><span class="co">#&gt; 26  inequality -2.92155657 -3.0710043524 -5.34361866 -0.97848394       9</span></span>
<span><span class="co">#&gt; 27      income -1.30332701 -1.1544859487 -3.18558994  0.38345647       9</span></span>
<span><span class="co">#&gt; 28    ideology -2.40726202 -2.7708770491 -4.60976607  1.31138316       9</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; --------------------------------</span></span>
<span><span class="co">#&gt; Context-level coefficients:</span></span>
<span><span class="co">#&gt;                Description   Post.Mean HPD.lower HPD.upper</span></span>
<span><span class="co">#&gt; 1     Intercept of beta[0]  0.12619947 -1.801457  2.838104</span></span>
<span><span class="co">#&gt; 2     Intercept of beta[1]  0.05711040 -2.335675  2.859441</span></span>
<span><span class="co">#&gt; 3     Intercept of beta[2]  0.06469138 -2.658142  3.017111</span></span>
<span><span class="co">#&gt; 4     Intercept of beta[3] -1.15512670 -3.720378  1.392619</span></span>
<span><span class="co">#&gt; 5 Effect of gap on beta[0] -0.26597899 -2.944234  1.489864</span></span>
<span><span class="co">#&gt; 6 Effect of gap on beta[1] -0.06752216 -1.966709  2.031430</span></span>
<span><span class="co">#&gt; 7 Effect of gap on beta[2] -0.52717792 -2.298119  1.867981</span></span>
<span><span class="co">#&gt; 8 Effect of gap on beta[3]  0.54672003 -1.496271  2.984713</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; --------------------------------</span></span></code></pre></div>
<p>The <code>summary</code> contains more information now. As before,
the column <code>k</code> indicates the estimated clusters. The column
<code>j</code> indicates the country (context) of the estimated value
for the respective cluster’s coefficient. The second summary
(<code>$tau</code>) shows the marginal effect of the context-level
feature (<code>gap</code>). Details of the interpretation can be found
in <span class="citation">Ferrari (2020)</span>.</p>
<p>There are a series of built-in functions to visualize the output. The
function <code><a href="../reference/plot_tau.html">plot_tau()</a></code> displays the estimation of the effect
of the context-level variables.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_tau.html">plot_tau</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span></code></pre></div>
<p><img src="hdpGLM_files/figure-html/unnamed-chunk-10-1.png" width="691.2"></p>
<p>The function <code><a href="../reference/plot_pexp_beta.html">plot_pexp_beta()</a></code> displays the association
between the context-level features and the latent heterogeneity in the
effect of the linear coefficients in each context. The paramter
‘smooth.line’ plots a line representing the linear association between
the context-level feature (<code>gap</code>) and the posterior averages
of the marginal effects in each cluster. The parameter
<code>ncol.beta</code> controls the number of columns in the figure for
the panels. For more options, see <code><a href="../reference/plot_pexp_beta.html">help(plot_pexp_beta)</a></code></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_pexp_beta.html">plot_pexp_beta</a></span><span class="op">(</span><span class="va">mod</span>, smooth.line<span class="op">=</span><span class="cn">TRUE</span>, ncol.beta<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Generating plots ...</span></span>
<span><span class="co">#&gt; Warning: The `&lt;scale&gt;` argument of `guides()` cannot be `FALSE`. Use "none" instead as</span></span>
<span><span class="co">#&gt; of ggplot2 3.3.4.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> The deprecated feature was likely used in the <span style="color: #0000BB;">hdpGLM</span> package.</span></span>
<span><span class="co">#&gt;   Please report the issue at <span style="color: #0000BB; font-style: italic;">&lt;https://github.com/DiogoFerrari/hdpGLM/issues&gt;</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">This warning is displayed once every 8 hours.</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">Call `lifecycle::last_lifecycle_warnings()` to see where this warning was</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">generated.</span></span></span>
<span><span class="co">#&gt; `geom_smooth()` using formula = 'y ~ x'</span></span>
<span><span class="co">#&gt; `geom_smooth()` using formula = 'y ~ x'</span></span></code></pre></div>
<p><img src="hdpGLM_files/figure-html/unnamed-chunk-11-1.png" width="691.2"></p>
</div>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="reference">Reference<a class="anchor" aria-label="anchor" href="#reference"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-ferrari2020modeling" class="csl-entry">
Ferrari, Diogo. 2020. <span>“Modeling Context-Dependent Latent Effect
Heterogeneity.”</span> <em>Political Analysis</em> 28 (1): 20–46.
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by <a href="http://diogoferrari.com" class="external-link">Diogo Ferrari</a>.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
