<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Hierarchical Dirichlet Process GLM — hdpGLM • hdpGLM</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Hierarchical Dirichlet Process GLM — hdpGLM" />
<meta property="og:description" content="The function estimates a semi-parametric mixture of Generalized
Linear Models. It uses a (hierarchical) Dependent Dirichlet Process
Prior for the mixture probabilities." />
<meta name="twitter:card" content="summary" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">hdpGLM</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/hdpGLM.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/DiogoFerrari/hdpGLM">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Hierarchical Dirichlet Process GLM</h1>
    <small class="dont-index">Source: <a href='https://github.com/DiogoFerrari/hdpGLM/blob/master/R/src_main.R'><code>R/src_main.R</code></a></small>
    <div class="hidden name"><code>hdpGLM.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>The function estimates a semi-parametric mixture of Generalized
Linear Models. It uses a (hierarchical) Dependent Dirichlet Process
Prior for the mixture probabilities.</p>
    </div>

    <pre class="usage"><span class='fu'>hdpGLM</span>(<span class='no'>formula1</span>, <span class='kw'>formula2</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='no'>data</span>, <span class='kw'>context.id</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>weights</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='no'>mcmc</span>, <span class='kw'>K</span> <span class='kw'>=</span> <span class='fl'>100</span>, <span class='kw'>fix</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>family</span> <span class='kw'>=</span> <span class='st'>"gaussian"</span>,
  <span class='kw'>epsilon</span> <span class='kw'>=</span> <span class='fl'>0.01</span>, <span class='kw'>leapFrog</span> <span class='kw'>=</span> <span class='fl'>40</span>, <span class='kw'>n.display</span> <span class='kw'>=</span> <span class='fl'>1000</span>, <span class='kw'>hmc_iter</span> <span class='kw'>=</span> <span class='fl'>1</span>,
  <span class='kw'>imp.bin</span> <span class='kw'>=</span> <span class='st'>"R"</span>, <span class='kw'>na.action</span> <span class='kw'>=</span> <span class='st'>"exclude"</span>)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>formula1</th>
      <td><p>a single symbolic description of the linear model of the
mixture GLM components to be fitted. The syntax is the same
as used in the <code><a href='https://rdrr.io/r/stats/lm.html'>lm</a></code> function.</p></td>
    </tr>
    <tr>
      <th>formula2</th>
      <td><p>eihter NULL (default) or a single symbolic description of the
linear model of the hierarchical component of the model.
It specifies how the average parameter of the base measure
of the Dirichlet Process Prior varies linearly as a function
of group level covariates. If <code>NULL</code>, it will use
a single base measure to the DPP mixture model.</p></td>
    </tr>
    <tr>
      <th>data</th>
      <td><p>a data.frame with all the variables specified in <code>formula1</code> and <code>formula2</code>. Note: it is advisable to scale the variables before the estimation</p></td>
    </tr>
    <tr>
      <th>context.id</th>
      <td><p>string with the name of the column in the data that uniquely identifies the contexts. If <code>NULL</code> (default) contexts will be identified by numerical indexes and unique context-level variables. The user is advised to pre-process the data to provide meaningful labels for the contexts to facilitate later visualization and analysis of the results.</p></td>
    </tr>
    <tr>
      <th>weights</th>
      <td><p>numeric vector with the same size as the number of rows of the data. It must contain the weights of the observations in the data set. NOTE: FEATURE NOT IMPLEMENTED YET</p></td>
    </tr>
    <tr>
      <th>mcmc</th>
      <td><p>a list containing elements named <code>burn.in</code> (required, an
integer greater or equal to 0 indicating the number iterations used in the
burn-in period of the MCMC) and <code>n.iter</code> (required, an integer greater or
equal to 1 indicating the number of iterations to record after the burn-in
period for the MCMC).</p></td>
    </tr>
    <tr>
      <th>K</th>
      <td><p>an integer indicating the maximum number of clusters to truncate the
Dirichlet Process Prior in order to use the blocked Gibbs sampler.</p></td>
    </tr>
    <tr>
      <th>fix</th>
      <td><p>either NULL or a list with the constants of the model. If not NULL,
it must contain a vector named <code>mu_beta</code>, whose size must be
equal to the number of covariates specified in <code>formula1</code>
plus one for the constant term; <code>Sigma_beta</code>, which must be a squared
matrix, and each dimension must be equal to the size of the vector <code>mu_beta</code>; 
and <code>alpha</code>, which must be a single number. If @param family is 'gaussian',
then it must also contain <code>s2_sigma</code> and <code>df_sigma</code>, both
single numbers. If NULL, the defaults are <code>mu_beta=0</code>,
<code>Sigma_beta=diag(10)</code>, <code>alpha=1</code>, <code>df_sigma=10</code>,
<code>d2_sigma=10</code> (all with the dimension automatically set to the
correct values).</p></td>
    </tr>
    <tr>
      <th>family</th>
      <td><p>a character with either 'gaussian', 'binomial', or 'multinomial'.
It indicates the family of the GLM components of the mixture model.</p></td>
    </tr>
    <tr>
      <th>epsilon</th>
      <td><p>numeric, used when <code>family='binomial'</code> or <code>family='multinomial'</code>.
It is used in the Stormer-Verlet Integrator (a.k.a leapfrog integrator)
to solve the Hamiltonian Monte Carlo in the estimation of the model.
Default is 0.01.</p></td>
    </tr>
    <tr>
      <th>leapFrog</th>
      <td><p>an integer, used when <code>family='binomial'</code> or <code>family='multinomial'</code>.
It indicates the number of steps taken at each iteration of the Hamiltonian
Monte Carlo for the Stormer-Verlet Integrator. Default is 40.</p></td>
    </tr>
    <tr>
      <th>n.display</th>
      <td><p>an integer indicating the number of iterations to wait before printing information
about the estimation process. If zero, it does not display any information.
Note: displaying informaiton at every iteration (n.display=1) may increase
the time to estimate the model slightly.</p></td>
    </tr>
    <tr>
      <th>hmc_iter</th>
      <td><p>an integer, used when <code>family='binomial'</code> or <code>family='multinomial'</code>.
It indicates the number of HMC iteration(s) for each Gibbs iteration.
Default is 1.</p></td>
    </tr>
    <tr>
      <th>imp.bin</th>
      <td><p>string, either "R" or "Cpp" indicating the language of the implementation of the binomial model.</p></td>
    </tr>
    <tr>
      <th>na.action</th>
      <td><p>string with action to be taken for the <code>NA</code> values. (currently, only <code>exclude</code> is available)</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>The function returns a list with elements <code>samples</code>, <code>pik</code>, <code>max_active</code>,
        <code>n.iter</code>, <code>burn.in</code>, and <code>time.elapsed</code>. The <code>samples</code> element
        contains a MCMC object (from <span class="pkg">coda</span> package) with the samples from the posterior
        distribution. The <code>pik</code> is a <code>n x K</code> matrix with the estimated
        probabilities that the observation $i$ belongs to the cluster $k$</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>This function estimates a Hierarchical Dirichlet Process generalized
linear model, which is a semi-parametric Bayesian approach to regression
estimation with clustering. The estimation is conducted using Blocked Gibbs Sampler if the output
variable is gaussian distributed. It uses Metropolis-Hastings inside Gibbs if
the output variable is binomial or multinomial distributed.
This is specified using the parameter <code>family</code>. See:</p>
<p>Ferrari, D. (2020). Modeling Context-Dependent Latent Effect Heterogeneity,
Political Analysis, 28(1), 20–46.</p>
<p>Ishwaran, H., &amp; James, L. F., Gibbs sampling methods for stick-breaking priors,
Journal of the American Statistical Association, 96(453), 161–173 (2001).</p>
<p>Neal, R. M., Markov chain sampling methods for dirichlet process mixture models,
Journal of computational and graphical statistics, 9(2), 249–265 (2000).</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'>

<span class='co'>## Note: this example is for illustration. You can run the example</span>
<span class='co'>## manually with increased number of iterations to see the actual</span>
<span class='co'>## results, as well as the data size (n)</span>

<span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span>(<span class='fl'>10</span>)
<span class='no'>n</span> <span class='kw'>=</span> <span class='fl'>300</span>
<span class='no'>data</span> <span class='kw'>=</span> <span class='kw pkg'>tibble</span><span class='kw ns'>::</span><span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span>(<span class='kw'>x1</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span>(<span class='no'>n</span>, -<span class='fl'>3</span>),
                      <span class='kw'>x2</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span>(<span class='no'>n</span>,  <span class='fl'>3</span>),
                      <span class='kw'>z</span>  <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/sample.html'>sample</a></span>(<span class='fl'>1</span>:<span class='fl'>3</span>, <span class='no'>n</span>, <span class='kw'>replace</span><span class='kw'>=</span><span class='fl'>TRUE</span>),
                      <span class='kw'>y</span>  <span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/AsIs.html'>I</a></span>(<span class='no'>z</span><span class='kw'>==</span><span class='fl'>1</span>) * (<span class='fl'>3</span> + <span class='fl'>4</span>*<span class='no'>x1</span> - <span class='no'>x2</span> + <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span>(<span class='no'>n</span>)) +
                          <span class='fu'><a href='https://rdrr.io/r/base/AsIs.html'>I</a></span>(<span class='no'>z</span><span class='kw'>==</span><span class='fl'>2</span>) * (<span class='fl'>3</span> + <span class='fl'>2</span>*<span class='no'>x1</span> + <span class='no'>x2</span> + <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span>(<span class='no'>n</span>)) +
                          <span class='fu'><a href='https://rdrr.io/r/base/AsIs.html'>I</a></span>(<span class='no'>z</span><span class='kw'>==</span><span class='fl'>3</span>) * (<span class='fl'>3</span> - <span class='fl'>4</span>*<span class='no'>x1</span> - <span class='no'>x2</span> + <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span>(<span class='no'>n</span>))
                      )


<span class='no'>mcmc</span>    <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='kw'>burn.in</span> <span class='kw'>=</span> <span class='fl'>0</span>,  <span class='kw'>n.iter</span> <span class='kw'>=</span> <span class='fl'>20</span>)
<span class='no'>samples</span> <span class='kw'>=</span> <span class='fu'>hdpGLM</span>(<span class='no'>y</span>~ <span class='no'>x1</span> + <span class='no'>x2</span>, <span class='kw'>data</span><span class='kw'>=</span><span class='no'>data</span>, <span class='kw'>mcmc</span><span class='kw'>=</span><span class='no'>mcmc</span>, <span class='kw'>family</span><span class='kw'>=</span><span class='st'>'gaussian'</span>,
                 <span class='kw'>n.display</span><span class='kw'>=</span><span class='fl'>30</span>, <span class='kw'>K</span><span class='kw'>=</span><span class='fl'>50</span>)</div><div class='output co'>#&gt; 
#&gt; 
#&gt; Preparing for estimation ...
#&gt; 
#&gt; 
#&gt; 
#&gt; Estimation in progress ...
#&gt; 
#&gt; [========                                                               ] 10 %[===========                                                            ] 15 %[===============                                                        ] 20 %[==================                                                     ] 25 %[======================                                                 ] 30 %[=========================                                              ] 35 %[=============================                                          ] 40 %[================================                                       ] 45 %[====================================                                   ] 50 %[=======================================                                ] 55 %[===========================================                            ] 60 %[==============================================                         ] 65 %[==================================================                     ] 70 %[=====================================================                  ] 75 %[=========================================================              ] 80 %[============================================================           ] 85 %[================================================================       ] 90 %[===================================================================    ] 95 %[=======================================================================] 100 %[=======================================================================] 100 %</div><div class='input'>
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>samples</span>)</div><div class='output co'>#&gt; <span style='color: #555555;'># A tibble: 12 x 8</span><span>
#&gt;        k Parameter term          Mean Median    SD HPD.lower HPD.upper
#&gt;    </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>     </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>        </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>  </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>     </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>     </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>
#&gt; </span><span style='color: #555555;'> 1</span><span>     1 beta1     (Intercept)  2.62   2.79  0.522     1.49      3.41 
#&gt; </span><span style='color: #555555;'> 2</span><span>     1 beta2     x1           2.00   2.05  0.192     1.29      2.19 
#&gt; </span><span style='color: #555555;'> 3</span><span>     1 beta3     x2           1.08   1.07  0.133     0.806     1.40 
#&gt; </span><span style='color: #555555;'> 4</span><span>     1 sigma     sigma        0.966  0.946 0.118     0.819     1.20 
#&gt; </span><span style='color: #555555;'> 5</span><span>     2 beta1     (Intercept)  3.42   3.49  0.885     0.193     4.55 
#&gt; </span><span style='color: #555555;'> 6</span><span>     2 beta2     x1          -</span><span style='color: #BB0000;'>3.85</span><span>  -</span><span style='color: #BB0000;'>3.92</span><span>  0.337    -</span><span style='color: #BB0000;'>4.11</span><span>     -</span><span style='color: #BB0000;'>2.50</span><span> 
#&gt; </span><span style='color: #555555;'> 7</span><span>     2 beta3     x2          -</span><span style='color: #BB0000;'>0.964</span><span> -</span><span style='color: #BB0000;'>1.07</span><span>  0.613    -</span><span style='color: #BB0000;'>1.39</span><span>      1.60 
#&gt; </span><span style='color: #555555;'> 8</span><span>     2 sigma     sigma        1.08   1.03  0.215     0.835     1.85 
#&gt; </span><span style='color: #555555;'> 9</span><span>     3 beta1     (Intercept)  2.51   2.36  0.504     1.43      3.30 
#&gt; </span><span style='color: #555555;'>10</span><span>     3 beta2     x1           3.61   3.75  0.764     0.407     4.01 
#&gt; </span><span style='color: #555555;'>11</span><span>     3 beta3     x2          -</span><span style='color: #BB0000;'>1.21</span><span>  -</span><span style='color: #BB0000;'>1.06</span><span>  0.667    -</span><span style='color: #BB0000;'>3.98</span><span>     -</span><span style='color: #BB0000;'>0.630</span><span>
#&gt; </span><span style='color: #555555;'>12</span><span>     3 sigma     sigma        1.09   1.04  0.166     0.878     1.53 </div><div class='input'><span class='fu'><a href='https://rdrr.io/r/graphics/plot.html'>plot</a></span>(<span class='no'>samples</span>)</div><div class='output co'>#&gt; 
#&gt; 
#&gt; Generating plot...
#&gt; </div><div class='img'><img src='hdpGLM-1.png' alt='' width='700' height='433' /></div><div class='input'><span class='fu'><a href='https://rdrr.io/r/graphics/plot.html'>plot</a></span>(<span class='no'>samples</span>, <span class='kw'>separate</span><span class='kw'>=</span><span class='fl'>TRUE</span>)</div><div class='output co'>#&gt; 
#&gt; 
#&gt; Generating plot...
#&gt; </div><div class='img'><img src='hdpGLM-2.png' alt='' width='700' height='433' /></div><div class='input'>
## compare with GLM
## lm(y~ x1 + x2, data=data,  family='gaussian')

 
</div></span></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      <li><a href="#value">Value</a></li>
      <li><a href="#details">Details</a></li>
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Diogo Ferrari.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.0.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


