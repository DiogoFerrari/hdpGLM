<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>hdpGLM • hdpGLM</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="hdpGLM">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">hdpGLM</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/hdpGLM.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="https://www.cambridge.org/core/journals/political-analysis/article/modeling-contextdependent-latent-effect-heterogeneity/B7B0AF067DF97A1A8F0B50646EF64F24">Paper</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/DiogoFerrari/hdpGLM">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><link href="hdpGLM_files/anchor-sections-1.0/anchor-sections.css" rel="stylesheet">
<script src="hdpGLM_files/anchor-sections-1.0/anchor-sections.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>hdpGLM</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/DiogoFerrari/hdpGLM/blob/master/vignettes/hdpGLM.Rmd"><code>vignettes/hdpGLM.Rmd</code></a></small>
      <div class="hidden name"><code>hdpGLM.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>The package hdpGLM makes it easy to estimate semi-parametric regression models, and summarize and visualize the results. The package is useful for many purposes:</p>
<ol style="list-style-type: decimal">
<li>Find clusters using semi-parametric Bayesian methods (Dirichlet Process)</li>
<li>Find a set of generalized linear models (GLM) that apply to different latent subpopulations</li>
<li>Estimate latent heterogeneity in the marginal effect of regression coefficients</li>
<li>Investigate if Simpson’s Paradox occurs due to latent or omitted features</li>
<li>Cluster the data points based on marginal effect heterogeneity</li>
<li>All the above, but with hierarchical data from many contexts (e.g., schools, hospitals, cities, states, countries, etc.)</li>
<li>Find the effect of context-level features (upper-level covariates) on the latent heterogeneity of within-context features (lower-level covariates)</li>
</ol>
</div>
<div id="background" class="section level2">
<h2 class="hasAnchor">
<a href="#background" class="anchor"></a>Background</h2>
<p>The <code>hdpGLM</code> works similarly to linear regression models. It estimates coefficients of linear regressions, including generalized linear models, such as logit coefficients. But it simultaneously searches for latent clusters in the data and estimates the linear coefficients for those clusters. The result of the estimation is <span class="math inline">\(K\)</span> vectors of linear coefficients, one vector for each cluster. If there are no clusters in the data, it returns the estimated coefficients similar to classical regression models.</p>
<p>The clustering procedure is based on a hierarchical semi-parametric Bayesian model proposed in <span class="citation">Ferrari (2020)</span>. The model, called Hierarchical Dirichlet process Generalized Linear Models (hdpGLM), can be used to deal with latent heterogeneity in different situations, including those that emerge due to unobserved variables. It deals with the latent heterogeneity in two ways: (1) it finds latent clusters which can be better described by different regression models and (2) estimate the coefficient of those models. The hdpGLM can also be used with hierarchical data to estimate latent heterogeneity in multiple contexts and check if the clusters are context-dependent (see an example in section <a href="#Estimating-Context-dependent-Latent-Heterogeneity">Estimating Context-dependent latent heterogeneity</a>).</p>
<p>The linear model is estimated by sampling from the posterior distribution using a Gibbs sampler. Non-linear models (e.g., logit with binary outcomes) use Hamiltonian Monte Carlo within Gibbs. The algorithms are presented in <span class="citation">Ferrari (2020)</span>.</p>
<p>Why should we estimate clusters of linear regressions instead of fitting a single regression model?</p>
<p>First, it improves the predictive performance of the regression model and keeps the interpretability of the regression coefficients. <code>hdpGLM</code> is much more flexible than traditional regression and produces monotonically lower root mean square error (see <span class="citation">Ferrari (2020)</span> for details).</p>
<p>Second, latent heterogeneity emerges when there are omitted variables in the estimation of regression models. The <code>hdpGLM</code> can be used to estimate marginal effects even when interactions were omitted. It recovers the linear coefficients of each latent group.</p>
</div>
<div id="usage" class="section level2">
<h2 class="hasAnchor">
<a href="#usage" class="anchor"></a>Usage</h2>
<div id="estimation" class="section level3">
<h3 class="hasAnchor">
<a href="#estimation" class="anchor"></a>Estimation</h3>
<p>The function <code>hdpGLM</code> estimates a semi-parametric Bayesian regression model. The syntax is similar to other R functions such as <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code>, <code><a href="https://rdrr.io/r/stats/glm.html">glm()</a></code>, and <code>lmer()</code>.</p>
<p>Here is a toy example. Suppose we are studying how income inequality affects support policies that help alleviate poverty in a given country A. Yet, suppose further that (1) the effect of inequality varies between groups of people; for some people, inequality increases support for welfare policies, but for others, it decreases welfare policy support; (2) we don’t know which individual belongs to which group. The data set <code>welfare</code> contains simulated data for this example.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="co">## loading and looking at the data</span></a>
<a class="sourceLine" id="cb1-2" title="2">welfare =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/utils/read.table.html">read.csv2</a></span>(<span class="st">'welfare.csv'</span>)</a>
<a class="sourceLine" id="cb1-3" title="3"><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(welfare)</a>
<a class="sourceLine" id="cb1-4" title="4"><span class="co">#&gt;       support inequality     income   ideology</span></a>
<a class="sourceLine" id="cb1-5" title="5"><span class="co">#&gt; 1 -18.5649610  0.3392724  0.1425111  1.9225985</span></a>
<a class="sourceLine" id="cb1-6" title="6"><span class="co">#&gt; 2  -9.3905812 -0.9906646 -0.5117102  0.2483346</span></a>
<a class="sourceLine" id="cb1-7" title="7"><span class="co">#&gt; 3   0.9276234 -2.2318510 -0.3856288 -1.3619216</span></a>
<a class="sourceLine" id="cb1-8" title="8"><span class="co">#&gt; 4 -12.3594498 -3.0079501 -0.9440585 -0.2088675</span></a>
<a class="sourceLine" id="cb1-9" title="9"><span class="co">#&gt; 5  -2.4834411  0.1000455  0.8322192  0.1321378</span></a>
<a class="sourceLine" id="cb1-10" title="10"><span class="co">#&gt; 6 -11.4187853 -0.9543883 -0.8810503  0.2916444</span></a></code></pre></div>
<p>Now, suppose that inequality increases support for welfare only among women, but it decreases support among men. We didn’t collect data on gender (male versus female). We could estimate the <code>hdpGLM</code> and recover the coefficients even if gender wasn’t observed. The package provides a function called <code>hdpGLM</code>, which estimates a semi-parametric Bayesian generalized linear model using a Dirichlet mixture. Let’s estimate the model. The example uses few iterations in the MCMC, but in real applications, one should use a much larger number.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(hdpGLM)</a>
<a class="sourceLine" id="cb2-2" title="2"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb2-3" title="3"><span class="co">#&gt; ## =======================================================================</span></a>
<a class="sourceLine" id="cb2-4" title="4"><span class="co">#&gt; ##    Hierarchial Dirichlet Process Generalized Linear Model (hdpGLM)</span></a>
<a class="sourceLine" id="cb2-5" title="5"><span class="co">#&gt; ## =======================================================================</span></a>
<a class="sourceLine" id="cb2-6" title="6"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb2-7" title="7"><span class="co">#&gt; Attaching package: 'hdpGLM'</span></a>
<a class="sourceLine" id="cb2-8" title="8"><span class="co">#&gt; The following object is masked _by_ '.GlobalEnv':</span></a>
<a class="sourceLine" id="cb2-9" title="9"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb2-10" title="10"><span class="co">#&gt;     welfare</span></a></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1"><span class="co">## estimating the model</span></a>
<a class="sourceLine" id="cb3-2" title="2">mcmc =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">burn.in=</span><span class="dv">10</span>, <span class="co">## MCMC burn-in period</span></a>
<a class="sourceLine" id="cb3-3" title="3">            <span class="dt">n.iter =</span><span class="dv">500</span>) <span class="co">## number of MCMC iterations to keep</span></a>
<a class="sourceLine" id="cb3-4" title="4">mod =<span class="st"> </span><span class="kw"><a href="../reference/hdpGLM.html">hdpGLM</a></span>(support <span class="op">~</span><span class="st"> </span>inequality <span class="op">+</span><span class="st"> </span>income <span class="op">+</span><span class="st"> </span>ideology, <span class="dt">data=</span>welfare,</a>
<a class="sourceLine" id="cb3-5" title="5">             <span class="dt">mcmc=</span>mcmc)</a></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1"><span class="co">## printing the outcome</span></a>
<a class="sourceLine" id="cb4-2" title="2"><span class="kw"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(mod)</a>
<a class="sourceLine" id="cb4-3" title="3"><span class="co">#&gt; # A tibble: 10 x 8</span></a>
<a class="sourceLine" id="cb4-4" title="4"><span class="co">#&gt;        k Parameter term          Mean Median     SD HPD.lower HPD.upper</span></a>
<a class="sourceLine" id="cb4-5" title="5"><span class="co">#&gt;    &lt;dbl&gt; &lt;chr&gt;     &lt;chr&gt;        &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb4-6" title="6"><span class="co">#&gt;  1     1 beta1     (Intercept) -3.87  -3.87  0.0401    -3.96      -3.80</span></a>
<a class="sourceLine" id="cb4-7" title="7"><span class="co">#&gt;  2     1 beta2     inequality   2.00   2.00  0.0355     1.93       2.06</span></a>
<a class="sourceLine" id="cb4-8" title="8"><span class="co">#&gt;  3     1 beta3     income       3.85   3.85  0.0368     3.79       3.93</span></a>
<a class="sourceLine" id="cb4-9" title="9"><span class="co">#&gt;  4     1 beta4     ideology    -8.31  -8.31  0.0399    -8.39      -8.24</span></a>
<a class="sourceLine" id="cb4-10" title="10"><span class="co">#&gt;  5     1 sigma     sigma        0.999  0.997 0.0478     0.918      1.10</span></a>
<a class="sourceLine" id="cb4-11" title="11"><span class="co">#&gt;  6     6 beta1     (Intercept) -3.82  -3.82  0.0384    -3.89      -3.75</span></a>
<a class="sourceLine" id="cb4-12" title="12"><span class="co">#&gt;  7     6 beta2     inequality  -1.53  -1.53  0.0375    -1.59      -1.45</span></a>
<a class="sourceLine" id="cb4-13" title="13"><span class="co">#&gt;  8     6 beta3     income       3.88   3.88  0.0348     3.81       3.94</span></a>
<a class="sourceLine" id="cb4-14" title="14"><span class="co">#&gt;  9     6 beta4     ideology    -8.26  -8.26  0.0363    -8.34      -8.19</span></a>
<a class="sourceLine" id="cb4-15" title="15"><span class="co">#&gt; 10     6 sigma     sigma        0.965  0.964 0.0598     0.852      1.09</span></a></code></pre></div>
<p>The summary function prints the result in a tidy format. The column <code>k</code> in the summary shows the label of the estimated clusters. The column <code>Mean</code> is the average of the posterior distribution for each linear coefficient in each cluster.</p>
<p>The function <code>hdpGLM_classify</code> can be used to classify the data points into clusters based on the estimation.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1">welfare_clustered =<span class="st"> </span><span class="kw"><a href="../reference/hdpGLM_classify.html">hdpGLM_classify</a></span>(welfare, mod)</a>
<a class="sourceLine" id="cb5-2" title="2"><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(welfare_clustered)</a>
<a class="sourceLine" id="cb5-3" title="3"><span class="co">#&gt;   Cluster     support inequality     income   ideology</span></a>
<a class="sourceLine" id="cb5-4" title="4"><span class="co">#&gt; 1       1 -18.5649610  0.3392724  0.1425111  1.9225985</span></a>
<a class="sourceLine" id="cb5-5" title="5"><span class="co">#&gt; 2       1  -9.3905812 -0.9906646 -0.5117102  0.2483346</span></a>
<a class="sourceLine" id="cb5-6" title="6"><span class="co">#&gt; 3       1   0.9276234 -2.2318510 -0.3856288 -1.3619216</span></a>
<a class="sourceLine" id="cb5-7" title="7"><span class="co">#&gt; 4       1 -12.3594498 -3.0079501 -0.9440585 -0.2088675</span></a>
<a class="sourceLine" id="cb5-8" title="8"><span class="co">#&gt; 5       6  -2.4834411  0.1000455  0.8322192  0.1321378</span></a>
<a class="sourceLine" id="cb5-9" title="9"><span class="co">#&gt; 6       1 -11.4187853 -0.9543883 -0.8810503  0.2916444</span></a>
<a class="sourceLine" id="cb5-10" title="10"><span class="kw"><a href="https://rdrr.io/r/utils/head.html">tail</a></span>(welfare_clustered)</a>
<a class="sourceLine" id="cb5-11" title="11"><span class="co">#&gt;      Cluster     support  inequality     income   ideology</span></a>
<a class="sourceLine" id="cb5-12" title="12"><span class="co">#&gt; 1995       6  -1.5230053 1.055855140 -0.7295937 -0.7067871</span></a>
<a class="sourceLine" id="cb5-13" title="13"><span class="co">#&gt; 1996       6   0.4814892 0.582588091  2.0051082  0.3090389</span></a>
<a class="sourceLine" id="cb5-14" title="14"><span class="co">#&gt; 1997       6 -14.1929956 0.391164197 -0.9607449  0.7765482</span></a>
<a class="sourceLine" id="cb5-15" title="15"><span class="co">#&gt; 1998       6  -8.2396789 0.074437376  1.2020300  1.0874928</span></a>
<a class="sourceLine" id="cb5-16" title="16"><span class="co">#&gt; 1999       6 -23.1583753 0.434223018 -0.6176438  2.0387294</span></a>
<a class="sourceLine" id="cb5-17" title="17"><span class="co">#&gt; 2000       6  -7.2075582 0.008355317 -0.4538951  0.2268072</span></a></code></pre></div>
<p>There are a series of built-in functions, with various options, to plot the results. In the example below, you see two of those options. The <code>separate</code> parameter plot the posterior samples for each cluster separately, and the option <code>ncols</code> controls how many columns to use for the panels in the figure (to see more, run <code><a href="https://rdrr.io/r/utils/help.html">help(plot.hdpGLM)</a></code> and <code><a href="https://rdrr.io/r/utils/help.html">help(plot.dpGLM)</a></code>).</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(mod, <span class="dt">separate=</span>T, <span class="dt">ncols=</span><span class="dv">4</span>)</a>
<a class="sourceLine" id="cb6-2" title="2"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb6-3" title="3"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb6-4" title="4"><span class="co">#&gt; Generating plot...</span></a></code></pre></div>
<p><img src="hdpGLM_files/figure-html/unnamed-chunk-6-1.png" width="691.2"></p>
</div>
<div id="estimating-context-dependent-latent-heterogeneity" class="section level3">
<h3 class="hasAnchor">
<a href="#estimating-context-dependent-latent-heterogeneity" class="anchor"></a>Estimating Context-dependent Latent Heterogeneity</h3>
<p>To continue the previous toy example, suppose that we are analyzing data from many countries, and we suspect that the latent heterogeneity is different in each country. The effect of inequality on support for welfare may be gender-specific only in some countries (contexts). Or maybe the way it is gender-specific varies from country to country. Suppose we didn’t have data on gender, but we collect information on countries’ gender gap in welfare provision. Let’s look at this new data set.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1"><span class="co">## loading and looking at the data</span></a>
<a class="sourceLine" id="cb7-2" title="2">welfare =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/utils/read.table.html">read.csv2</a></span>(<span class="st">'welfare2.csv'</span>)</a>
<a class="sourceLine" id="cb7-3" title="3"><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(welfare)</a>
<a class="sourceLine" id="cb7-4" title="4"><span class="co">#&gt;       support inequality     income   ideology country gap</span></a>
<a class="sourceLine" id="cb7-5" title="5"><span class="co">#&gt; 1 -18.5649610  0.3392724  0.1425111  1.9225985       0 0.1</span></a>
<a class="sourceLine" id="cb7-6" title="6"><span class="co">#&gt; 2  -9.3905812 -0.9906646 -0.5117102  0.2483346       0 0.1</span></a>
<a class="sourceLine" id="cb7-7" title="7"><span class="co">#&gt; 3   0.9276234 -2.2318510 -0.3856288 -1.3619216       0 0.1</span></a>
<a class="sourceLine" id="cb7-8" title="8"><span class="co">#&gt; 4 -12.3594498 -3.0079501 -0.9440585 -0.2088675       0 0.1</span></a>
<a class="sourceLine" id="cb7-9" title="9"><span class="co">#&gt; 5  -2.4834411  0.1000455  0.8322192  0.1321378       0 0.1</span></a>
<a class="sourceLine" id="cb7-10" title="10"><span class="co">#&gt; 6 -11.4187853 -0.9543883 -0.8810503  0.2916444       0 0.1</span></a>
<a class="sourceLine" id="cb7-11" title="11"><span class="kw"><a href="https://rdrr.io/r/utils/head.html">tail</a></span>(welfare)</a>
<a class="sourceLine" id="cb7-12" title="12"><span class="co">#&gt;         support inequality     income    ideology country        gap</span></a>
<a class="sourceLine" id="cb7-13" title="13"><span class="co">#&gt; 3195  0.3190583 -0.7504798 -0.7839583  0.92300705       4 -0.8280808</span></a>
<a class="sourceLine" id="cb7-14" title="14"><span class="co">#&gt; 3196 -1.3837239  0.6620435 -1.5566268  0.05634618       4 -0.8280808</span></a>
<a class="sourceLine" id="cb7-15" title="15"><span class="co">#&gt; 3197 -1.3820016 -0.4298706 -1.0945688  0.71559078       4 -0.8280808</span></a>
<a class="sourceLine" id="cb7-16" title="16"><span class="co">#&gt; 3198  0.6878775  0.5450604  2.6175887 -1.94844469       4 -0.8280808</span></a>
<a class="sourceLine" id="cb7-17" title="17"><span class="co">#&gt; 3199 -7.9282930  1.7846004  1.6755823  1.29160208       4 -0.8280808</span></a>
<a class="sourceLine" id="cb7-18" title="18"><span class="co">#&gt; 3200 -1.7472485  0.5030992 -0.5395479  0.20109879       4 -0.8280808</span></a></code></pre></div>
<p>The variable <code>country</code> indicates the country (context) of the observation, and the variable <code>gap</code> the gender gap in welfare provision in the respective country. The estimation is similar to the previous example, but now there is a second <code>formula</code> for the context-level variables. Again, the example below uses few iterations in the MCMC, but in practical applications, one needs to increase that).</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1"><span class="co">## estimating the model</span></a>
<a class="sourceLine" id="cb8-2" title="2">mcmc =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">burn.in=</span><span class="dv">1</span>, <span class="co">## MCMC burn-in period</span></a>
<a class="sourceLine" id="cb8-3" title="3">            <span class="dt">n.iter =</span><span class="dv">50</span>) <span class="co">## number of MCMC iterations to keep</span></a>
<a class="sourceLine" id="cb8-4" title="4">mod =<span class="st"> </span><span class="kw"><a href="../reference/hdpGLM.html">hdpGLM</a></span>(support <span class="op">~</span><span class="st"> </span>inequality <span class="op">+</span><span class="st"> </span>income <span class="op">+</span><span class="st"> </span>ideology, </a>
<a class="sourceLine" id="cb8-5" title="5">             support <span class="op">~</span><span class="st"> </span>gap,</a>
<a class="sourceLine" id="cb8-6" title="6">         <span class="dt">data=</span>welfare, <span class="dt">mcmc=</span>mcmc)</a></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(mod)</a>
<a class="sourceLine" id="cb9-2" title="2"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb9-3" title="3"><span class="co">#&gt; Generating summary for beta...</span></a>
<a class="sourceLine" id="cb9-4" title="4"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb9-5" title="5"><span class="co">#&gt; Generating summary for tau...</span></a>
<a class="sourceLine" id="cb9-6" title="6"><span class="co">#&gt; $beta</span></a>
<a class="sourceLine" id="cb9-7" title="7"><span class="co">#&gt; # A tibble: 155 x 9</span></a>
<a class="sourceLine" id="cb9-8" title="8"><span class="co">#&gt;        k     j Parameter term           Mean  Median     SD HPD.lower HPD.upper</span></a>
<a class="sourceLine" id="cb9-9" title="9"><span class="co">#&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;     &lt;chr&gt;         &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb9-10" title="10"><span class="co">#&gt;  1     1     1 beta[0]   (Intercept) -3.86   -3.86   0.0522   -3.98      -3.76 </span></a>
<a class="sourceLine" id="cb9-11" title="11"><span class="co">#&gt;  2     1     1 beta[1]   inequality   1.77    1.87   0.368     0.531      2.04 </span></a>
<a class="sourceLine" id="cb9-12" title="12"><span class="co">#&gt;  3     1     1 beta[2]   income       3.85    3.86   0.0529    3.73       3.93 </span></a>
<a class="sourceLine" id="cb9-13" title="13"><span class="co">#&gt;  4     1     1 beta[3]   ideology    -8.30   -8.30   0.0384   -8.36      -8.21 </span></a>
<a class="sourceLine" id="cb9-14" title="14"><span class="co">#&gt;  5     1     1 sigma     sigma        1.01    1.00   0.0508    0.913      1.13 </span></a>
<a class="sourceLine" id="cb9-15" title="15"><span class="co">#&gt;  6     1     2 beta[0]   (Intercept) -0.182  -0.155  1.41     -4.99       3.84 </span></a>
<a class="sourceLine" id="cb9-16" title="16"><span class="co">#&gt;  7     1     2 beta[1]   inequality  -0.561  -1.03   1.64     -1.44       3.95 </span></a>
<a class="sourceLine" id="cb9-17" title="17"><span class="co">#&gt;  8     1     2 beta[2]   income      -0.324  -0.270  1.09     -4.48       1.12 </span></a>
<a class="sourceLine" id="cb9-18" title="18"><span class="co">#&gt;  9     1     2 beta[3]   ideology    -2.17   -2.10   0.868    -4.93      -0.297</span></a>
<a class="sourceLine" id="cb9-19" title="19"><span class="co">#&gt; 10     1     2 sigma     sigma        0.0936  0.0924 0.0230    0.0515     0.132</span></a>
<a class="sourceLine" id="cb9-20" title="20"><span class="co">#&gt; # … with 145 more rows</span></a>
<a class="sourceLine" id="cb9-21" title="21"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb9-22" title="22"><span class="co">#&gt; $tau</span></a>
<a class="sourceLine" id="cb9-23" title="23"><span class="co">#&gt; # A tibble: 8 x 8</span></a>
<a class="sourceLine" id="cb9-24" title="24"><span class="co">#&gt;       w  beta Parameter Description               Mean    SD HPD.lower HPD.upper</span></a>
<a class="sourceLine" id="cb9-25" title="25"><span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;fct&gt;     &lt;chr&gt;                    &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb9-26" title="26"><span class="co">#&gt; 1     0     0 tau[0][0] Intercept of beta[0]   -0.422   1.29     -2.73      1.74</span></a>
<a class="sourceLine" id="cb9-27" title="27"><span class="co">#&gt; 2     0     1 tau[0][1] Intercept of beta[1]   -0.259   1.51     -2.88      2.51</span></a>
<a class="sourceLine" id="cb9-28" title="28"><span class="co">#&gt; 3     0     2 tau[0][2] Intercept of beta[2]   -0.262   1.66     -3.64      2.48</span></a>
<a class="sourceLine" id="cb9-29" title="29"><span class="co">#&gt; 4     0     3 tau[0][3] Intercept of beta[3]   -1.27    1.35     -3.74      1.18</span></a>
<a class="sourceLine" id="cb9-30" title="30"><span class="co">#&gt; 5     1     0 tau[1][0] Effect of gap on beta…  0.0202  1.13     -2.76      1.97</span></a>
<a class="sourceLine" id="cb9-31" title="31"><span class="co">#&gt; 6     1     1 tau[1][1] Effect of gap on beta… -0.0939  1.13     -2.14      2.19</span></a>
<a class="sourceLine" id="cb9-32" title="32"><span class="co">#&gt; 7     1     2 tau[1][2] Effect of gap on beta… -0.764   1.24     -2.75      1.17</span></a>
<a class="sourceLine" id="cb9-33" title="33"><span class="co">#&gt; 8     1     3 tau[1][3] Effect of gap on beta…  0.464   1.14     -1.88      2.29</span></a></code></pre></div>
<p>The <code>summary</code> contains more information now. As before, the column <code>k</code> indicates the estimated clusters. The column <code>j</code> indicates the country (context) of the estimated value for the respective cluster’s coefficient. The second summary (<code>$tau</code>) shows the marginal effect of the context-level feature (<code>gap</code>). Details of the interpretation can be found in <span class="citation">Ferrari (2020)</span>.</p>
<p>There are a series of built-in functions to visualize the output. The function <code><a href="../reference/plot_tau.html">plot_tau()</a></code> displays the estimation of the effect of the context-level variables.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1"><span class="kw"><a href="../reference/plot_tau.html">plot_tau</a></span>(mod)</a>
<a class="sourceLine" id="cb10-2" title="2"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb10-3" title="3"><span class="co">#&gt; Generating summary for beta...</span></a>
<a class="sourceLine" id="cb10-4" title="4"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb10-5" title="5"><span class="co">#&gt; Generating summary for tau...</span></a></code></pre></div>
<p><img src="hdpGLM_files/figure-html/unnamed-chunk-10-1.png" width="691.2"></p>
<p>The function <code><a href="../reference/plot_pexp_beta.html">plot_pexp_beta()</a></code> displays the association between the context-level features and the latent heterogeneity in the effect of the linear coefficients in each context. The paramter ‘smooth.line’ plots a line representing the linear association between the context-level feature (<code>gap</code>) and the posterior averages of the marginal effects in each cluster. The parameter <code>ncol.beta</code> controls the number of columns in the figure for the panels. For more options, see <code><a href="https://rdrr.io/r/utils/help.html">help(plot_pexp_beta)</a></code></p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1"><span class="kw"><a href="../reference/plot_pexp_beta.html">plot_pexp_beta</a></span>(mod, <span class="dt">smooth.line=</span><span class="ot">TRUE</span>, <span class="dt">ncol.beta=</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb11-2" title="2"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb11-3" title="3"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb11-4" title="4"><span class="co">#&gt; Generating plots ...</span></a>
<a class="sourceLine" id="cb11-5" title="5"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb11-6" title="6"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb11-7" title="7"><span class="co">#&gt; Generating summary for beta...</span></a>
<a class="sourceLine" id="cb11-8" title="8"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb11-9" title="9"><span class="co">#&gt; Generating summary for tau...</span></a></code></pre></div>
<p><img src="hdpGLM_files/figure-html/unnamed-chunk-11-1.png" width="691.2"></p>
</div>
</div>
<div id="reference" class="section level2 unnumbered">
<h2 class="hasAnchor">
<a href="#reference" class="anchor"></a>Reference</h2>
<div id="refs" class="references">
<div id="ref-ferrari2020modeling">
<p>Ferrari, Diogo. 2020. “Modeling Context-Dependent Latent Effect Heterogeneity.” <em>Political Analysis</em> 28 (1): 20–46.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li><a href="#background">Background</a></li>
      <li><a href="#usage">Usage</a></li>
      <li><a href="#reference">Reference</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="http://diogoferrari.com">Diogo Ferrari</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.0.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
